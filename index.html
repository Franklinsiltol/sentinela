<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinela - An√°lise Inteligente de Conversas</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1/dist/transformers.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #FFFFFF;
            --accent-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
            --info-color: #2196F3;
            --light-gray: #f5f7fa;
            --medium-gray: #e4e7ed;
            --dark-gray: #333333;
            --sidebar-width: 300px;
            --header-height: 70px;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--primary-color);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Header */
        .header {
            height: var(--header-height);
            background-color: var(--secondary-color);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            padding: 0 20px;
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .header.collapsed {
            left: 70px;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            gap: 15px;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--secondary-color);
            box-shadow: var(--box-shadow);
            padding: 20px;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 70px;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--primary-color);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .logo-icon {
            font-size: 2rem;
            margin-right: 10px;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            padding: 90px 20px 20px 20px;
            width: calc(100% - var(--sidebar-width));
            transition: var(--transition);
        }

        .main-content.expanded {
            margin-left: 70px;
            width: calc(100% - 70px);
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 1.2rem;
        }

        .sidebar.collapsed .section-title span {
            display: none;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            background-color: var(--secondary-color);
            color: var(--primary-color);
            transition: var(--transition);
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: 2px solid var(--primary-color);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .button:hover {
            background-color: var(--dark-gray);
            border-color: var(--dark-gray);
        }

        .button-primary {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }

        .button-secondary {
            background-color: transparent;
            color: var(--primary-color);
        }

        .button-success {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .button-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            color: black;
        }

        .button-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
            color: white;
        }

        .button-info {
            background-color: var(--info-color);
            border-color: var(--info-color);
            color: white;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-success {
            background-color: var(--accent-color);
        }

        .status-error {
            background-color: var(--danger-color);
        }

        .status-warning {
            background-color: var(--warning-color);
        }

        /* Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .dashboard-title {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .metric-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }

        .metric-trend {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .trend-up {
            color: var(--accent-color);
        }

        .trend-down {
            color: var(--danger-color);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background-color: var(--light-gray);
        }

        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50vh;
            text-align: center;
        }

        .spinner {
            border: 3px solid var(--medium-gray);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert i {
            font-size: 1.2rem;
        }

        .alert-info {
            background-color: #e3f2fd;
            border-left: 4px solid var(--info-color);
        }

        .alert-warning {
            background-color: #fff3cd;
            border-left: 4px solid var(--warning-color);
        }

        .alert-success {
            background-color: #e8f5e9;
            border-left: 4px solid var(--accent-color);
        }

        .alert-error {
            background-color: #ffebee;
            border-left: 4px solid var(--danger-color);
        }

        /* Progress bars */
        .progress-bar {
            height: 8px;
            background-color: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            border-radius: 4px;
        }

        /* Cards */
        .card {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* Forms */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--medium-gray);
        }

        .data-table th {
            background-color: var(--light-gray);
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: var(--light-gray);
        }

        /* Chat bubbles */
        .chat-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
        }

        .chat-agent {
            background-color: var(--secondary-color);
            padding: 12px 15px;
            border-radius: 18px 18px 18px 0;
            margin: 8px 0;
            border-left: 4px solid var(--accent-color);
            max-width: 80%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .chat-client {
            background-color: #e3f2fd;
            padding: 12px 15px;
            border-radius: 18px 18px 0 18px;
            margin: 8px 0 8px auto;
            border-left: 4px solid var(--info-color);
            max-width: 80%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .chat-sender {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-gray);
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 70px 15px 15px 15px;
            }
            
            .header {
                left: 0;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .dashboard-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #FFFFFF;
                --secondary-color: #1a1a1a;
                --light-gray: #2d2d2d;
                --medium-gray: #3d3d3d;
                --dark-gray: #cccccc;
            }
        }

        /* Estilos para an√°lise de palavras */
        .word-cloud-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            padding: 20px;
            min-height: 300px;
            align-items: center;
        }
        
        .word-item {
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
            margin: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .word-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .search-result-item {
            background: var(--light-gray);
            padding: 15px;
            margin: 10px 0;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--info-color);
        }
        
        .search-highlight {
            background-color: yellow;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .phrase-analysis {
            margin-top: 20px;
        }
        
        .stop-words-list {
            max-height: 200px;
            overflow-y: auto;
            background: var(--light-gray);
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 10px;
        }
        
        .stop-word-item {
            display: inline-block;
            background: var(--medium-gray);
            padding: 4px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        /* Estilos para IA Avan√ßada */
        .insight-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            box-shadow: var(--box-shadow);
        }
        
        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .insight-icon {
            font-size: 1.5rem;
        }
        
        .insight-content {
            line-height: 1.6;
        }
        
        .model-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }
        
        .status-loading {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .status-ready {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .status-error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .analysis-progress {
            width: 100%;
            height: 8px;
            background-color: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }
        
        .topic-item {
            background: var(--light-gray);
            padding: 12px;
            margin: 8px 0;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--info-color);
        }
        
        .confidence-badge {
            background: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .sentiment-distribution {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }
        
        .sentiment-bar {
            flex: 1;
            height: 8px;
            border-radius: 4px;
        }
        
        .recommendation-item {
            padding: 12px;
            margin: 8px 0;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--warning-color);
        }

        /* Estilos para an√°lise de √°udio */
        .audio-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .audio-visualizer {
            width: 100%;
            height: 100px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: var(--accent-color);
            margin: 0 1px;
        }
        
        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #ffebee;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }
        
        .pulse {
            width: 12px;
            height: 12px;
            background: #f44336;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }
        
        .transcription-result {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .transcription-line {
            padding: 8px;
            margin: 5px 0;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .transcription-line:hover {
            background: var(--medium-gray);
            border-left-color: var(--info-color);
        }
        
        .speaker-label {
            font-weight: bold;
            color: var(--info-color);
            margin-right: 8px;
        }
        
        .audio-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .audio-metric {
            text-align: center;
            padding: 15px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .waveform-container {
            width: 100%;
            height: 80px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }
        
        .audio-player-custom {
            width: 100%;
            margin: 10px 0;
        }

        .paste-transcription-container {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
        }
        
        /* Adicionar estilos para o progresso do modelo */
        .model-progress {
            margin-top: 10px;
        }
        
        .progress-text {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="logo">
                <div class="logo-icon">üõ°Ô∏è</div>
                <div class="logo-text">Sentinela</div>
            </div>
            
            <div class="sidebar-content">
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </h3>
                    <div class="input-group">
                        <label>Data Inicial</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="input-group">
                        <label>Data Final</label>
                        <input type="date" id="endDate">
                    </div>
                    <button class="button button-primary" id="applyFilter">
                        <i class="fas fa-filter"></i>
                        <span>Aplicar Filtro</span>
                    </button>
                </div>
                
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-database"></i>
                        <span>Fontes de Dados</span>
                    </h3>
                    <div class="input-group">
                        <label>Upload de Arquivo</label>
                        <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls">
                    </div>
                    <div class="input-group">
                        <label>ID da Planilha Google</label>
                        <input type="text" id="sheetId" placeholder="ID da planilha">
                    </div>
                    <div class="input-group">
                        <label>Nome da Aba</label>
                        <input type="text" id="sheetTab" placeholder="Nome da aba (ex: P√°gina1)">
                    </div>
                    <button class="button button-primary" id="loadData">
                        <i class="fas fa-sync-alt"></i>
                        <span>Carregar Dados</span>
                    </button>
                </div>
                
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        <span>Estat√≠sticas</span>
                    </h3>
                    <div id="statsContainer">
                        <div class="metric-card">
                            <div class="metric-label">Total de Intera√ß√µes</div>
                            <div class="metric-value" id="statInteractions">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Total de Mensagens</div>
                            <div class="metric-value" id="statMessages">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Agentes √önicos</div>
                            <div class="metric-value" id="statAgents">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header" id="header">
            <div class="header-title">Painel de An√°lise</div>
            <div class="header-actions">
                <button class="button button-info" id="exportData">
                    <i class="fas fa-download"></i>
                    Exportar
                </button>
                <button class="button button-primary" id="refreshData">
                    <i class="fas fa-redo"></i>
                    Atualizar
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <p>Carregando Sentinela...</p>
            </div>
            
            <div id="contentArea" class="hidden">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Bem-vindo ao Sentinela!</strong> Carregue seus dados para come√ßar a an√°lise.
                    </div>
                </div>
                
                <!-- M√©tricas Principais -->
                <div class="metrics-grid" id="metricsGrid">
                    <div class="metric-card">
                        <div class="metric-icon">üõ°Ô∏è</div>
                        <div class="metric-value" id="metricInteractions">0</div>
                        <div class="metric-label">Intera√ß√µes</div>
                        <div class="metric-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>12% vs per√≠odo anterior</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üí¨</div>
                        <div class="metric-value" id="metricMessages">0</div>
                        <div class="metric-label">Mensagens</div>
                        <div class="metric-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>8% vs per√≠odo anterior</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">‚úÖ</div>
                        <div class="metric-value" id="metricPositive">0</div>
                        <div class="metric-label">Positivas</div>
                        <div class="metric-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>5% vs per√≠odo anterior</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">‚ö†Ô∏è</div>
                        <div class="metric-value" id="metricNegative">0</div>
                        <div class="metric-label">Negativas</div>
                        <div class="metric-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>3% vs per√≠odo anterior</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üîç</div>
                        <div class="metric-value" id="metricProblems">0</div>
                        <div class="metric-label">Problemas</div>
                        <div class="metric-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>7% vs per√≠odo anterior</span>
                        </div>
                    </div>
                </div>
                
                <!-- Abas -->
                <div class="tabs" id="mainTabs">
                    <div class="tab active" data-tab="overview">
                        <i class="fas fa-chart-bar"></i>
                        Vis√£o Geral
                    </div>
                    <div class="tab" data-tab="agents">
                        <i class="fas fa-users"></i>
                        Agentes
                    </div>
                    <div class="tab" data-tab="trends">
                        <i class="fas fa-chart-line"></i>
                        Tend√™ncias
                    </div>
                    <div class="tab" data-tab="words">
                        <i class="fas fa-font"></i>
                        An√°lise de Texto
                    </div>
                    <div class="tab" data-tab="ai">
                        <i class="fas fa-robot"></i>
                        Sentinela IA
                    </div>
                    <div class="tab" data-tab="audio">
                        <i class="fas fa-microphone"></i>
                        An√°lise de √Åudio
                    </div>
                </div>
                
                <!-- Conte√∫do das Abas -->
                <div id="tabContents">
                    <div class="tab-content active" id="overview">
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-smile"></i>
                                    Distribui√ß√£o de Sentimento
                                </div>
                                <div id="sentimentChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-users"></i>
                                    Agentes com Mais Atendimentos
                                </div>
                                <div id="agentsChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-chart-pie"></i>
                                    An√°lise de Conte√∫do
                                </div>
                                <div id="contentChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-calendar-alt"></i>
                                    Evolu√ß√£o Temporal
                                </div>
                                <div id="temporalChart"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="agents">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Desempenho por Agente</div>
                                <button class="button button-info" id="exportAgents">
                                    <i class="fas fa-download"></i>
                                    Exportar Relat√≥rio
                                </button>
                            </div>
                            <div id="agentsTable"></div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="trends">
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-chart-line"></i>
                                    Tend√™ncia de Sentimento
                                </div>
                                <div id="trendsChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-arrow-up"></i>
                                    T√≥picos em Alta
                                </div>
                                <div id="topicsChart"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="words">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">An√°lise de Palavras</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Buscar Palavra ou Frase</label>
                                    <input type="text" id="wordSearch" placeholder="Digite para buscar...">
                                </div>
                                <div class="form-group">
                                    <label>Filtrar por Agente</label>
                                    <select id="agentFilter">
                                        <option value="">Todos os Agentes</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <button class="button button-primary" id="searchWords">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                                <button class="button button-info" id="generateWordCloud">
                                    <i class="fas fa-cloud"></i>
                                    Nuvem de Palavras
                                </button>
                            </div>
                            <div id="wordAnalysisResults"></div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="ai">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">An√°lise com Sentinela IA</div>
                                <div id="modelStatus" class="model-status status-loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>Carregando modelos de IA...</span>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-robot"></i>
                                <div>
                                    <strong>Sentinela IA</strong> - Tecnologia avan√ßada de an√°lise inteligente integrada.
                                </div>
                            </div>

                            <!-- Progresso do Carregamento do Modelo -->
                            <div id="modelProgress" class="model-progress hidden">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="modelProgressFill" style="width: 0%"></div>
                                </div>
                                <div class="progress-text" id="modelProgressText">
                                    Preparando Sentinela IA: 0%
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tipo de An√°lise</label>
                                    <select id="analysisType">
                                        <option value="sentiment">An√°lise de Sentimento</option>
                                        <option value="topics">Identifica√ß√£o de T√≥picos</option>
                                        <option value="summary">Sumariza√ß√£o</option>
                                        <option value="keywords">Extrair Palavras-chave</option>
                                        <option value="quality">An√°lise de Qualidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Modelo Sentinela IA</label>
                                    <select id="modelSelection">
                                        <option value="sentiment">An√°lise de Sentimento</option>
                                        <option value="summarization">Sumariza√ß√£o de Texto</option>
                                        <option value="keywords">Extra√ß√£o de Palavras-chave</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label>Instru√ß√µes para An√°lise</label>
                                <textarea id="iaPrompt" rows="4">Analise estas conversas e identifique os principais problemas, oportunidades de melhoria e pontos fortes:</textarea>
                            </div>
                            
                            <div class="form-row">
                                <button class="button button-primary" id="generateInsights">
                                    <i class="fas fa-brain"></i>
                                    Gerar Insights com Sentinela IA
                                </button>
                                <button class="button button-info" id="quickAnalysis">
                                    <i class="fas fa-bolt"></i>
                                    An√°lise R√°pida
                                </button>
                                <button class="button button-secondary" id="clearAnalysis">
                                    <i class="fas fa-times"></i>
                                    Limpar
                                </button>
                                <button class="button button-warning" id="clearCache">
                                    <i class="fas fa-trash"></i>
                                    Limpar Cache
                                </button>
                            </div>
                            
                            <div id="analysisProgress" class="analysis-progress hidden">
                                <div class="progress-bar-fill" id="progressFill" style="width: 0%"></div>
                            </div>
                            
                            <div id="iaResults" class="mt-20"></div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Informa√ß√µes do Sistema</div>
                            </div>
                            <div id="modelInfo">
                                <p>Sentinela IA inicializando...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="audio">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">An√°lise de √Åudio</div>
                            </div>
                            <div class="alert alert-info">
                                <i class="fas fa-microphone"></i>
                                <div>
                                    <strong>An√°lise de Conversas por √Åudio</strong> - Transcreva e analise conversas de √°udio.
                                </div>
                            </div>
                            
                            <div class="audio-controls">
                                <button class="button button-primary" id="startRecording">
                                    <i class="fas fa-microphone"></i>
                                    Iniciar Grava√ß√£o
                                </button>
                                <button class="button button-secondary" id="stopRecording" disabled>
                                    <i class="fas fa-stop"></i>
                                    Parar Grava√ß√£o
                                </button>
                                <button class="button button-info" id="uploadAudio">
                                    <i class="fas fa-upload"></i>
                                    Upload de √Åudio
                                </button>
                                <input type="file" id="audioFile" accept="audio/*" class="hidden">
                            </div>
                            
                            <div id="recordingIndicator" class="recording-indicator hidden">
                                <div class="pulse"></div>
                                <span>Gravando... <span id="recordingTime">00:00</span></span>
                            </div>
                            
                            <div class="audio-visualizer" id="audioVisualizer">
                                <!-- Barras do visualizador ser√£o geradas dinamicamente -->
                            </div>
                            
                            <div class="paste-transcription-container">
                                <div class="input-group">
                                    <label>Ou cole a transcri√ß√£o manualmente:</label>
                                    <textarea id="manualTranscription" rows="4" placeholder="Cole aqui a transcri√ß√£o da conversa..."></textarea>
                                </div>
                                <button class="button button-primary" id="analyzeTranscription">
                                    <i class="fas fa-chart-bar"></i>
                                    Analisar Transcri√ß√£o
                                </button>
                            </div>
                            
                            <div id="transcriptionResult" class="transcription-result hidden">
                                <!-- Resultado da transcri√ß√£o ser√° exibido aqui -->
                            </div>
                            
                            <div id="audioAnalysisResults" class="mt-20"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE CACHE INDEXEDDB
        // =============================================
        class SentinelaCacheManager {
            constructor() {
                this.dbName = 'SentinelaCache';
                this.dbVersion = 1;
                this.db = null;
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('analises')) {
                            const store = db.createObjectStore('analises', { keyPath: 'id' });
                            store.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                    };
                });
            }

            async salvarAnalise(id, dados) {
                if (!this.db) await this.init();
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['analises'], 'readwrite');
                    const store = transaction.objectStore('analises');
                    
                    const item = {
                        id: id,
                        dados: dados,
                        timestamp: Date.now(),
                        tamanho: new Blob([JSON.stringify(dados)]).size
                    };
                    
                    const request = store.put(item);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                });
            }

            async carregarAnalise(id) {
                if (!this.db) await this.init();
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['analises'], 'readonly');
                    const store = transaction.objectStore('analises');
                    const request = store.get(id);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        if (request.result) {
                            resolve(request.result.dados);
                        } else {
                            resolve(null);
                        }
                    };
                });
            }

            async limparCache() {
                if (!this.db) await this.init();
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['analises'], 'readwrite');
                    const store = transaction.objectStore('analises');
                    const request = store.clear();
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        resolve();
                        mostrarAlerta('‚úÖ Cache limpo com sucesso!', 'success');
                    };
                });
            }

            async obterInfoCache() {
                if (!this.db) await this.init();
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['analises'], 'readonly');
                    const store = transaction.objectStore('analises');
                    const request = store.getAll();
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        const items = request.result;
                        const tamanhoTotal = items.reduce((sum, item) => sum + (item.tamanho || 0), 0);
                        resolve({
                            quantidade: items.length,
                            tamanhoTotal: tamanhoTotal,
                            analises: items.map(item => ({
                                id: item.id,
                                timestamp: new Date(item.timestamp).toLocaleDateString('pt-BR'),
                                tamanho: this.formatarBytes(item.tamanho || 0)
                            }))
                        });
                    };
                });
            }

            formatarBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        // =============================================
        // SENTINELA IA - SISTEMA PRINCIPAL
        // =============================================
        class SentinelaIA {
            constructor() {
                this.inicializada = false;
                this.gerenciadorCache = new SentinelaCacheManager();
                this.classificador = null;
                this.sumariador = null;
                this.progressoAtual = 0;
            }

            async inicializar() {
                try {
                    mostrarAlerta('üîÑ Inicializando Sentinela IA...', 'info');
                    
                    // Inicializar cache
                    await this.gerenciadorCache.init();
                    
                    // Mostrar informa√ß√µes do cache
                    await this.atualizarInfoCache();
                    
                    this.inicializada = true;
                    
                    // Carregar modelo de sentimentos por padr√£o
                    await this.carregarModeloSentimentos();
                    
                    return true;
                    
                } catch (error) {
                    console.error('Erro na inicializa√ß√£o da Sentinela IA:', error);
                    mostrarAlerta('‚ùå Erro ao inicializar Sentinela IA', 'error');
                    return false;
                }
            }

            async carregarModeloSentimentos() {
                try {
                    const elementoStatus = document.getElementById('modelStatus');
                    elementoStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Preparando an√°lise de sentimentos...</span>';
                    
                    // Mostrar progresso
                    document.getElementById('modelProgress').classList.remove('hidden');
                    
                    // Usar um modelo bem leve para sentimentos
                    this.classificador = await pipeline(
                        'text-classification',
                        'Xenova/bert-base-multilingual-uncased-sentiment',
                        {
                            progress_callback: (progress) => {
                                this.atualizarProgresso(progress);
                            }
                        }
                    );
                    
                    document.getElementById('modelProgress').classList.add('hidden');
                    elementoStatus.innerHTML = '<i class="fas fa-check-circle"></i><span>An√°lise de sentimentos pronta!</span>';
                    elementoStatus.className = 'model-status status-ready';
                    
                    mostrarAlerta('‚úÖ M√≥dulo de sentimentos carregado com sucesso!', 'success');
                    
                } catch (error) {
                    console.error('Erro ao carregar modelo de sentimentos:', error);
                    mostrarAlerta('‚ö†Ô∏è Usando an√°lise de sentimentos b√°sica', 'warning');
                }
            }

            async carregarModeloSumarizacao() {
                try {
                    const elementoStatus = document.getElementById('modelStatus');
                    elementoStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Preparando sumariza√ß√£o...</span>';
                    
                    document.getElementById('modelProgress').classList.remove('hidden');
                    
                    // Modelo para sumariza√ß√£o
                    this.sumariador = await pipeline(
                        'summarization',
                        'Xenova/distilbart-cnn-6-6',
                        {
                            progress_callback: (progress) => {
                                this.atualizarProgresso(progress);
                            }
                        }
                    );
                    
                    document.getElementById('modelProgress').classList.add('hidden');
                    elementoStatus.innerHTML = '<i class="fas fa-check-circle"></i><span>Sumariza√ß√£o pronta!</span>';
                    elementoStatus.className = 'model-status status-ready';
                    
                    mostrarAlerta('‚úÖ M√≥dulo de sumariza√ß√£o carregado com sucesso!', 'success');
                    
                } catch (error) {
                    console.error('Erro ao carregar modelo de sumariza√ß√£o:', error);
                    mostrarAlerta('‚ùå Erro ao carregar sumariza√ß√£o', 'error');
                }
            }

            atualizarProgresso(progress) {
                this.progressoAtual = (progress.loaded / progress.total) * 100;
                
                const preenchimentoProgresso = document.getElementById('modelProgressFill');
                const textoProgresso = document.getElementById('modelProgressText');
                
                preenchimentoProgresso.style.width = `${this.progressoAtual}%`;
                textoProgresso.textContent = `Preparando Sentinela IA: ${Math.round(this.progressoAtual)}%`;
                
                // Atualizar status a cada 10%
                if (Math.round(this.progressoAtual) % 10 === 0) {
                    const elementoStatus = document.getElementById('modelStatus');
                    elementoStatus.innerHTML = `<i class="fas fa-spinner fa-spin"></i><span>Preparando... ${Math.round(this.progressoAtual)}%</span>`;
                }
            }

            async analisarSentimento(texto) {
                if (!this.classificador) {
                    throw new Error('M√≥dulo de sentimentos n√£o carregado');
                }

                try {
                    const resultado = await this.classificador(texto);
                    return this.interpretarResultadoSentimento(resultado);
                } catch (error) {
                    console.error('Erro na an√°lise de sentimentos:', error);
                    throw error;
                }
            }

            interpretarResultadoSentimento(resultado) {
                if (Array.isArray(resultado)) {
                    resultado = resultado[0];
                }

                const rotulo = resultado.label;
                const pontuacao = resultado.score;

                // Converter para nossa escala
                let sentimento, pontuacaoNormalizada;
                
                if (rotulo.includes('positive') || rotulo.includes('pos')) {
                    sentimento = pontuacao > 0.7 ? 'Muito Positivo' : 'Positivo';
                    pontuacaoNormalizada = pontuacao > 0.7 ? 1.5 + pontuacao : 0.5 + pontuacao;
                } else if (rotulo.includes('negative') || rotulo.includes('neg')) {
                    sentimento = pontuacao > 0.7 ? 'Muito Negativo' : 'Negativo';
                    pontuacaoNormalizada = pontuacao > 0.7 ? -1.5 - pontuacao : -0.5 - pontuacao;
                } else {
                    sentimento = 'Neutro';
                    pontuacaoNormalizada = 0;
                }

                return {
                    rotulo: sentimento,
                    pontuacao: pontuacaoNormalizada,
                    sentimento: sentimento,
                    confianca: pontuacao,
                    bruto: resultado
                };
            }

            async sumarizarTexto(texto, comprimentoMaximo = 150) {
                if (!this.sumariador) {
                    // Fallback para sumariza√ß√£o b√°sica
                    return this.sumarizacaoBasica(texto, comprimentoMaximo);
                }

                try {
                    const resultado = await this.sumariador(texto, {
                        max_length: comprimentoMaximo,
                        min_length: 30,
                        do_sample: false
                    });
                    
                    return resultado[0].summary_text;
                } catch (error) {
                    console.error('Erro na sumariza√ß√£o:', error);
                    return this.sumarizacaoBasica(texto, comprimentoMaximo);
                }
            }

            sumarizacaoBasica(texto, comprimentoMaximo) {
                const frases = texto.split(/[.!?]+/).filter(s => s.trim().length > 0);
                if (frases.length <= 3) {
                    return texto;
                }
                
                // Pegar as primeiras e √∫ltimas frases
                const sumario = frases.slice(0, 2).concat(frases.slice(-1)).join('. ') + '.';
                return sumario.length > comprimentoMaximo ? sumario.substring(0, comprimentoMaximo) + '...' : sumario;
            }

            async extrairPalavrasChave(texto, numPalavrasChave = 5) {
                // Implementa√ß√£o b√°sica de extra√ß√£o de palavras-chave
                const palavras = texto.toLowerCase()
                    .replace(/[^\w\s√†√°√¢√£√®√©√™√¨√≠√Æ√≤√≥√¥√µ√π√∫√ª√ß]/g, '')
                    .split(/\s+/)
                    .filter(palavra => palavra.length > 3);
                
                const frequencia = {};
                palavras.forEach(palavra => {
                    frequencia[palavra] = (frequencia[palavra] || 0) + 1;
                });
                
                return Object.entries(frequencia)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, numPalavrasChave)
                    .map(([palavra]) => palavra);
            }

            async gerarInsights(conversas, instrucoes) {
                if (!this.inicializada) {
                    throw new Error('Sentinela IA n√£o inicializada');
                }

                const textoCompleto = conversas.map(c => c.Texto).join(' ');
                
                // An√°lise de sentimentos
                const resultadoSentimento = await this.analisarSentimento(textoCompleto);
                
                // Sumariza√ß√£o
                const sumario = await this.sumarizarTexto(textoCompleto);
                
                // Palavras-chave
                const palavrasChave = await this.extrairPalavrasChave(textoCompleto, 8);
                
                // An√°lise de t√≥picos b√°sica
                const topicos = this.extrairTopicos(conversas);
                
                return {
                    sentimento: resultadoSentimento,
                    sumario: sumario,
                    palavrasChave: palavrasChave,
                    topicos: topicos,
                    recomendacoes: this.gerarRecomendacoes(resultadoSentimento, topicos),
                    confianca: resultadoSentimento.confianca,
                    usaSentinelaIA: true
                };
            }

            extrairTopicos(conversas) {
                const topicos = {
                    'Problemas T√©cnicos': 0,
                    'Atendimento ao Cliente': 0,
                    'Cobran√ßa e Pagamentos': 0,
                    'Produtos e Servi√ßos': 0,
                    'Elogios': 0,
                    'Reclama√ß√µes': 0
                };

                const palavrasChave = {
                    'Problemas T√©cnicos': ['erro', 'problema', 'bug', 'falha', 'n√£o funciona', 'quebrado', 'defeito'],
                    'Atendimento ao Cliente': ['atendimento', 'suporte', 'ajuda', 'assist√™ncia', 'consultor'],
                    'Cobran√ßa e Pagamentos': ['pagamento', 'cobran√ßa', 'fatura', 'cart√£o', 'dinheiro', 'pre√ßo'],
                    'Produtos e Servi√ßos': ['produto', 'servi√ßo', 'funcionalidade', 'recurso', 'aplicativo'],
                    'Elogios': ['parab√©ns', 'excelente', '√≥timo', 'maravilhoso', 'gostei', 'recomendo'],
                    'Reclama√ß√µes': ['reclama√ß√£o', 'insatisfeito', 'ruim', 'p√©ssimo', 'decepcionado', 'lento']
                };

                conversas.forEach(conversa => {
                    const texto = conversa.Texto.toLowerCase();
                    Object.keys(palavrasChave).forEach(topico => {
                        palavrasChave[topico].forEach(palavraChave => {
                            if (texto.includes(palavraChave)) {
                                topicos[topico]++;
                            }
                        });
                    });
                });

                return Object.entries(topicos)
                    .filter(([_, contagem]) => contagem > 0)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
            }

            gerarRecomendacoes(sentimento, topicos) {
                const recomendacoes = [];
                
                if (sentimento.pontuacao < 0) {
                    recomendacoes.push({
                        tipo: 'warning',
                        titulo: 'Sentimento Negativo Detectado',
                        descricao: 'Considere revisar processos de atendimento e treinamento da equipe.',
                        prioridade: 'Alta'
                    });
                }

                if (topicos.some(([topico, contagem]) => topico === 'Problemas T√©cnicos' && contagem > 2)) {
                    recomendacoes.push({
                        tipo: 'error',
                        titulo: 'Problemas T√©cnicos Frequentes',
                        descricao: 'Muitas men√ß√µes a problemas t√©cnicos. Avalie a estabilidade do sistema.',
                        prioridade: 'Alta'
                    });
                }

                if (topicos.some(([topico, contagem]) => topico === 'Elogios' && contagem > 0)) {
                    recomendacoes.push({
                        tipo: 'success',
                        titulo: 'Pontos Positivos Identificados',
                        descricao: 'Clientes est√£o elogiando alguns aspectos do servi√ßo. Mantenha essas pr√°ticas!',
                        prioridade: 'M√©dia'
                    });
                }

                recomendacoes.push({
                    tipo: 'info',
                    titulo: 'An√°lise Cont√≠nua Recomendada',
                    descricao: 'Monitore essas m√©tricas regularmente para identificar tend√™ncias.',
                    prioridade: 'M√©dia'
                });

                return recomendacoes;
            }

            async atualizarInfoCache() {
                try {
                    const infoCache = await this.gerenciadorCache.obterInfoCache();
                    const elementoInfo = document.getElementById('modelInfo');
                    
                    let html = `
                        <div class="metric-card">
                            <div class="metric-label">An√°lises em Cache</div>
                            <div class="metric-value">${infoCache.quantidade}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Tamanho do Cache</div>
                            <div class="metric-value">${this.gerenciadorCache.formatarBytes(infoCache.tamanhoTotal)}</div>
                        </div>
                    `;
                    
                    if (infoCache.analises.length > 0) {
                        html += '<div style="margin-top: 15px;"><strong>An√°lises Armazenadas:</strong><ul style="margin-top: 10px;">';
                        infoCache.analises.forEach(analise => {
                            html += `<li>${analise.id} (${analise.tamanho}) - ${analise.timestamp}</li>`;
                        });
                        html += '</ul></div>';
                    }
                    
                    elementoInfo.innerHTML = html;
                    
                } catch (error) {
                    console.error('Erro ao obter informa√ß√µes do cache:', error);
                }
            }

            async limparCache() {
                await this.gerenciadorCache.limparCache();
                await this.atualizarInfoCache();
                // Recarregar m√≥dulos necess√°rios
                await this.carregarModeloSentimentos();
            }
        }

        // =============================================
        // ATUALIZA√á√ÉO DO ESTADO DA APLICA√á√ÉO
        // =============================================
        const appState = {
            data: [],
            filteredData: [],
            metrics: {},
            currentTab: 'overview',
            isSidebarCollapsed: false,
            dailyStats: {},
            textAnalyzer: new TextAnalyzer(),
            sentinelaIA: new SentinelaIA(), // Substituir pelo novo sistema
            audioTranscriber: null
        };

        // =============================================
        // INICIALIZA√á√ÉO ATUALIZADA
        // =============================================
        async function inicializarSentinelaIA() {
            try {
                const elementoStatus = document.getElementById('modelStatus');
                elementoStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Inicializando Sentinela IA...</span>';
                
                const sucesso = await appState.sentinelaIA.inicializar();
                
                if (sucesso) {
                    elementoStatus.innerHTML = '<i class="fas fa-check-circle"></i><span>Sentinela IA Pronta!</span>';
                    elementoStatus.className = 'model-status status-ready';
                    mostrarAlerta('‚úÖ Sentinela IA carregada com sucesso!', 'success');
                } else {
                    elementoStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Sentinela IA n√£o dispon√≠vel</span>';
                    elementoStatus.className = 'model-status status-error';
                }
            } catch (error) {
                console.error('Erro na inicializa√ß√£o da Sentinela IA:', error);
                document.getElementById('modelStatus').innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Erro ao carregar Sentinela IA</span>';
                document.getElementById('modelStatus').className = 'model-status status-error';
            }
        }

        // =============================================
        // ATUALIZA√á√ÉO DOS EVENT LISTENERS
        // =============================================
        function configurarEventListeners() {
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.getAttribute('data-tab'));
                });
            });
            
            // Filtros
            document.getElementById('applyFilter').addEventListener('click', aplicarFiltros);
            document.getElementById('loadData').addEventListener('click', carregarDados);
            document.getElementById('refreshData').addEventListener('click', atualizarDados);
            document.getElementById('exportData').addEventListener('click', exportarDados);
            
            // An√°lise de texto
            document.getElementById('searchWords').addEventListener('click', buscarPalavras);
            document.getElementById('generateWordCloud').addEventListener('click', gerarNuvemPalavras);
            
            // Sentinela IA
            document.getElementById('generateInsights').addEventListener('click', gerarInsights);
            document.getElementById('clearCache').addEventListener('click', limparCacheModelos);
            document.getElementById('modelSelection').addEventListener('change', lidarComMudancaModelo);
            
            // An√°lise de √°udio
            document.getElementById('startRecording').addEventListener('click', iniciarGravacao);
            document.getElementById('stopRecording').addEventListener('click', pararGravacao);
            document.getElementById('uploadAudio').addEventListener('click', function() {
                document.getElementById('audioFile').click();
            });
            document.getElementById('audioFile').addEventListener('change', processarAudio);
            document.getElementById('analyzeTranscription').addEventListener('click', analisarTranscricao);
        }

        async function gerarInsights() {
            if (!appState.sentinelaIA.inicializada) {
                mostrarAlerta('‚ùå Sentinela IA n√£o est√° dispon√≠vel', 'error');
                return;
            }

            if (appState.filteredData.length === 0) {
                mostrarAlerta('‚ö†Ô∏è Nenhum dado dispon√≠vel para an√°lise', 'warning');
                return;
            }

            mostrarAlerta('üß† Gerando insights com Sentinela IA...', 'info');
            
            const elementoProgresso = document.getElementById('analysisProgress');
            const preenchimentoProgresso = document.getElementById('progressFill');
            elementoProgresso.classList.remove('hidden');
            
            try {
                let progresso = 0;
                const intervaloProgresso = setInterval(() => {
                    progresso += 2;
                    preenchimentoProgresso.style.width = `${Math.min(progresso, 90)}%`;
                    if (progresso >= 90) clearInterval(intervaloProgresso);
                }, 100);

                const instrucoes = document.getElementById('iaPrompt').value;
                const insights = await appState.sentinelaIA.gerarInsights(appState.filteredData, instrucoes);
                
                clearInterval(intervaloProgresso);
                preenchimentoProgresso.style.width = '100%';
                
                exibirInsights(insights);
                mostrarAlerta('‚úÖ Insights gerados com sucesso!', 'success');
                
                setTimeout(() => {
                    elementoProgresso.classList.add('hidden');
                    preenchimentoProgresso.style.width = '0%';
                }, 1000);
                
            } catch (error) {
                console.error('Erro na gera√ß√£o de insights:', error);
                mostrarAlerta('‚ùå Erro ao gerar insights: ' + error.message, 'error');
                elementoProgresso.classList.add('hidden');
            }
        }

        async function limparCacheModelos() {
            if (confirm('Tem certeza que deseja limpar o cache? Isso exigir√° novo carregamento dos m√≥dulos.')) {
                await appState.sentinelaIA.limparCache();
            }
        }

        async function lidarComMudancaModelo() {
            const modeloSelecionado = document.getElementById('modelSelection').value;
            
            try {
                if (modeloSelecionado === 'summarization') {
                    await appState.sentinelaIA.carregarModeloSumarizacao();
                } else if (modeloSelecionado === 'sentiment') {
                    await appState.sentinelaIA.carregarModeloSentimentos();
                }
            } catch (error) {
                console.error('Erro ao carregar modelo:', error);
                mostrarAlerta('‚ùå Erro ao carregar m√≥dulo selecionado', 'error');
            }
        }

        // =============================================
        // INICIALIZA√á√ÉO PRINCIPAL ATUALIZADA
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            inicializarApp();
        });

        async function inicializarApp() {
            try {
                // Inicializar Sentinela IA
                await inicializarSentinelaIA();
                
                configurarEventListeners();
                await carregarDadosExemplo();
                
                // Inicializar transcri√ß√£o de √°udio
                inicializarTranscricaoAudio();
                
                document.getElementById('loadingIndicator').classList.add('hidden');
                document.getElementById('contentArea').classList.remove('hidden');
                
                mostrarAlerta('‚úÖ Sentinela carregado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao inicializar:', error);
                mostrarAlerta('‚ùå Erro ao carregar o Sentinela', 'error');
            }
        }

        // =============================================
        // FUN√á√ïES DE EXEMPLO (para manter compatibilidade)
        // =============================================
        function exibirInsights(insights) {
            const container = document.getElementById('iaResults');
            
            let html = `
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üß†</div>
                        <h3>An√°lise Completa da Conversa</h3>
                    </div>
                    <div class="insight-content">
                        <p><strong>Resumo:</strong> ${insights.sumario}</p>
                        <p><strong>Sentimento Geral:</strong> ${insights.sentimento.sentimento} (Confian√ßa: ${(insights.sentimento.confianca * 100).toFixed(1)}%)</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">T√≥picos Identificados</div>
                    </div>
                    <div class="sentiment-distribution">
                        <div class="sentiment-bar" style="background-color: #4CAF50; width: 60%"></div>
                        <div class="sentiment-bar" style="background-color: #FFC107; width: 25%"></div>
                        <div class="sentiment-bar" style="background-color: #F44336; width: 15%"></div>
                    </div>
            `;
            
            if (insights.topicos && insights.topicos.length > 0) {
                html += '<div class="topic-list">';
                insights.topicos.forEach(([topico, contagem]) => {
                    html += `
                        <div class="topic-item">
                            <strong>${topico}</strong>
                            <span class="confidence-badge">${contagem} men√ß√µes</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += `
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Palavras-chave</div>
                    </div>
                    <div class="word-cloud-container">
            `;
            
            if (insights.palavrasChave && insights.palavrasChave.length > 0) {
                insights.palavrasChave.forEach((palavra, index) => {
                    const tamanho = 12 + (index * 2);
                    const cor = ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#F44336'][index % 5];
                    html += `<span class="word-item" style="font-size: ${tamanho}px; background-color: ${cor}; color: white;">${palavra}</span>`;
                });
            }
            
            html += `
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Recomenda√ß√µes</div>
                    </div>
            `;
            
            if (insights.recomendacoes && insights.recomendacoes.length > 0) {
                insights.recomendacoes.forEach(rec => {
                    let icone = 'info-circle';
                    let cor = 'info';
                    
                    if (rec.tipo === 'warning') {
                        icone = 'exclamation-triangle';
                        cor = 'warning';
                    } else if (rec.tipo === 'error') {
                        icone = 'exclamation-circle';
                        cor = 'danger';
                    } else if (rec.tipo === 'success') {
                        icone = 'check-circle';
                        cor = 'success';
                    }
                    
                    html += `
                        <div class="recommendation-item">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                <i class="fas fa-${icone} text-${cor}"></i>
                                <strong>${rec.titulo}</strong>
                                <span class="confidence-badge" style="background-color: ${cor === 'warning' ? '#FFC107' : cor === 'danger' ? '#F44336' : cor === 'success' ? '#4CAF50' : '#2196F3'}">${rec.prioridade}</span>
                            </div>
                            <p>${rec.descricao}</p>
                        </div>
                    `;
                });
            }
            
            html += `</div>`;
            
            container.innerHTML = html;
        }

        function mostrarAlerta(mensagem, tipo = 'info') {
            // Criar elemento de alerta
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo}`;
            alerta.innerHTML = `
                <i class="fas fa-${tipo === 'info' ? 'info-circle' : tipo === 'warning' ? 'exclamation-triangle' : tipo === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <div>${mensagem}</div>
            `;
            
            // Adicionar ao conte√∫do principal
            const contentArea = document.getElementById('contentArea');
            contentArea.insertBefore(alerta, contentArea.firstChild);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                alerta.remove();
            }, 5000);
        }

        // Fun√ß√µes de exemplo para manter compatibilidade
        async function carregarDadosExemplo() {
            // Simular carregamento de dados
            return new Promise(resolve => {
                setTimeout(() => {
                    // Dados de exemplo
                    appState.data = [
                        { Data: '2023-10-01', Agente: 'Jo√£o', Texto: 'Ol√°, como posso ajudar?', Sentimento: 'Positivo' },
                        { Data: '2023-10-01', Agente: 'Cliente', Texto: 'Estou com problemas no meu aplicativo', Sentimento: 'Negativo' },
                        { Data: '2023-10-02', Agente: 'Maria', Texto: 'Bom dia! Em que posso ser √∫til?', Sentimento: 'Positivo' },
                        { Data: '2023-10-02', Agente: 'Cliente', Texto: 'Preciso de ajuda com minha conta', Sentimento: 'Neutro' }
                    ];
                    appState.filteredData = [...appState.data];
                    atualizarMetricas();
                    resolve();
                }, 1000);
            });
        }

        function atualizarMetricas() {
            // Atualizar m√©tricas b√°sicas
            document.getElementById('metricInteractions').textContent = appState.filteredData.length;
            document.getElementById('metricMessages').textContent = appState.filteredData.length;
            document.getElementById('metricPositive').textContent = appState.filteredData.filter(d => d.Sentimento === 'Positivo').length;
            document.getElementById('metricNegative').textContent = appState.filteredData.filter(d => d.Sentimento === 'Negativo').length;
            document.getElementById('metricProblems').textContent = Math.floor(appState.filteredData.length * 0.2);
            
            // Atualizar estat√≠sticas da sidebar
            document.getElementById('statInteractions').textContent = appState.filteredData.length;
            document.getElementById('statMessages').textContent = appState.filteredData.length;
            document.getElementById('statAgents').textContent = new Set(appState.filteredData.map(d => d.Agente)).size;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const header = document.getElementById('header');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            header.classList.toggle('collapsed');
            
            appState.isSidebarCollapsed = !appState.isSidebarCollapsed;
        }

        function switchTab(tabName) {
            // Remover classe active de todas as abas
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active de todos os conte√∫dos
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Adicionar classe active √† aba selecionada
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            // Adicionar classe active ao conte√∫do selecionado
            document.getElementById(tabName).classList.add('active');
            
            appState.currentTab = tabName;
        }

        function aplicarFiltros() {
            // Implementa√ß√£o b√°sica de filtros
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                appState.filteredData = appState.data.filter(item => {
                    return item.Data >= startDate && item.Data <= endDate;
                });
            } else {
                appState.filteredData = [...appState.data];
            }
            
            atualizarMetricas();
            mostrarAlerta('Filtros aplicados com sucesso!', 'success');
        }

        function carregarDados() {
            // Implementa√ß√£o b√°sica de carregamento de dados
            mostrarAlerta('Carregando dados...', 'info');
            setTimeout(() => {
                mostrarAlerta('Dados carregados com sucesso!', 'success');
                atualizarMetricas();
            }, 1500);
        }

        function atualizarDados() {
            mostrarAlerta('Atualizando dados...', 'info');
            setTimeout(() => {
                mostrarAlerta('Dados atualizados com sucesso!', 'success');
            }, 1000);
        }

        function exportarDados() {
            mostrarAlerta('Exportando dados...', 'info');
            setTimeout(() => {
                mostrarAlerta('Dados exportados com sucesso!', 'success');
            }, 1000);
        }

        function buscarPalavras() {
            const termo = document.getElementById('wordSearch').value;
            if (!termo) {
                mostrarAlerta('Digite um termo para buscar', 'warning');
                return;
            }
            
            mostrarAlerta(`Buscando por: "${termo}"`, 'info');
        }

        function gerarNuvemPalavras() {
            mostrarAlerta('Gerando nuvem de palavras...', 'info');
        }

        function inicializarTranscricaoAudio() {
            // Placeholder para inicializa√ß√£o de transcri√ß√£o de √°udio
            console.log('Transcri√ß√£o de √°udio inicializada');
        }

        function iniciarGravacao() {
            mostrarAlerta('Iniciando grava√ß√£o...', 'info');
            document.getElementById('startRecording').disabled = true;
            document.getElementById('stopRecording').disabled = false;
            document.getElementById('recordingIndicator').classList.remove('hidden');
        }

        function pararGravacao() {
            mostrarAlerta('Grava√ß√£o parada', 'info');
            document.getElementById('startRecording').disabled = false;
            document.getElementById('stopRecording').disabled = true;
            document.getElementById('recordingIndicator').classList.add('hidden');
        }

        function processarAudio() {
            mostrarAlerta('Processando √°udio...', 'info');
        }

        function analisarTranscricao() {
            const transcricao = document.getElementById('manualTranscription').value;
            if (!transcricao) {
                mostrarAlerta('Digite ou cole uma transcri√ß√£o para analisar', 'warning');
                return;
            }
            
            mostrarAlerta('Analisando transcri√ß√£o...', 'info');
        }
    </script>
</body>
</html>
