<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinela - Análise Inteligente de Conversas</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos permanecem os mesmos do código original */
        :root {
            --primary-color: #000000;
            --secondary-color: #FFFFFF;
            --accent-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
            --info-color: #2196F3;
            --light-gray: #f5f7fa;
            --medium-gray: #e4e7ed;
            --dark-gray: #333333;
            --sidebar-width: 300px;
            --header-height: 70px;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--primary-color);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Header */
        .header {
            height: var(--header-height);
            background-color: var(--secondary-color);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            padding: 0 20px;
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .header.collapsed {
            left: 70px;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            gap: 15px;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--secondary-color);
            box-shadow: var(--box-shadow);
            padding: 20px;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 70px;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--primary-color);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .logo-icon {
            font-size: 2rem;
            margin-right: 10px;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            padding: 90px 20px 20px 20px;
            width: calc(100% - var(--sidebar-width));
            transition: var(--transition);
        }

        .main-content.expanded {
            margin-left: 70px;
            width: calc(100% - 70px);
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 1.2rem;
        }

        .sidebar.collapsed .section-title span {
            display: none;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            background-color: var(--secondary-color);
            color: var(--primary-color);
            transition: var(--transition);
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: 2px solid var(--primary-color);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .button:hover {
            background-color: var(--dark-gray);
            border-color: var(--dark-gray);
        }

        .button-primary {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }

        .button-secondary {
            background-color: transparent;
            color: var(--primary-color);
        }

        .button-success {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .button-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            color: black;
        }

        .button-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
            color: white;
        }

        .button-info {
            background-color: var(--info-color);
            border-color: var(--info-color);
            color: white;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-success {
            background-color: var(--accent-color);
        }

        .status-error {
            background-color: var(--danger-color);
        }

        .status-warning {
            background-color: var(--warning-color);
        }

        /* Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .dashboard-title {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .metric-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--dark-gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .trend-up {
            color: var(--accent-color);
        }

        .trend-down {
            color: var(--danger-color);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background-color: var(--light-gray);
        }

        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50vh;
            text-align: center;
        }

        .spinner {
            border: 3px solid var(--medium-gray);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert i {
            font-size: 1.2rem;
        }

        .alert-info {
            background-color: #e3f2fd;
            border-left: 4px solid var(--info-color);
        }

        .alert-warning {
            background-color: #fff3cd;
            border-left: 4px solid var(--warning-color);
        }

        .alert-success {
            background-color: #e8f5e9;
            border-left: 4px solid var(--accent-color);
        }

        .alert-error {
            background-color: #ffebee;
            border-left: 4px solid var(--danger-color);
        }

        /* Progress bars */
        .progress-bar {
            height: 8px;
            background-color: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            border-radius: 4px;
        }

        /* Cards */
        .card {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* Forms */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--medium-gray);
        }

        .data-table th {
            background-color: var(--light-gray);
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: var(--light-gray);
        }

        /* Chat bubbles */
        .chat-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
        }

        .chat-agent {
            background-color: var(--secondary-color);
            padding: 12px 15px;
            border-radius: 18px 18px 18px 0;
            margin: 8px 0;
            border-left: 4px solid var(--accent-color);
            max-width: 80%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .chat-client {
            background-color: #e3f2fd;
            padding: 12px 15px;
            border-radius: 18px 18px 0 18px;
            margin: 8px 0 8px auto;
            border-left: 4px solid var(--info-color);
            max-width: 80%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .chat-sender {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-gray);
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 70px 15px 15px 15px;
            }
            
            .header {
                left: 0;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .dashboard-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #FFFFFF;
                --secondary-color: #1a1a1a;
                --light-gray: #2d2d2d;
                --medium-gray: #3d3d3d;
                --dark-gray: #cccccc;
            }
        }

        /* Estilos para análise de palavras */
        .word-cloud-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            padding: 20px;
            min-height: 300px;
            align-items: center;
        }
        
        .word-item {
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
            margin: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .word-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .search-result-item {
            background: var(--light-gray);
            padding: 15px;
            margin: 10px 0;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--info-color);
        }
        
        .search-highlight {
            background-color: yellow;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .phrase-analysis {
            margin-top: 20px;
        }
        
        .stop-words-list {
            max-height: 200px;
            overflow-y: auto;
            background: var(--light-gray);
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 10px;
        }
        
        .stop-word-item {
            display: inline-block;
            background: var(--medium-gray);
            padding: 4px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        /* Estilos para IA Avançada */
        .insight-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            box-shadow: var(--box-shadow);
        }
        
        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .insight-icon {
            font-size: 1.5rem;
        }
        
        .insight-content {
            line-height: 1.6;
        }
        
        .model-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }
        
        .status-loading {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .status-ready {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .status-error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .analysis-progress {
            width: 100%;
            height: 8px;
            background-color: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }
        
        .topic-item {
           background: var(--light-gray);
    padding: 12px;
    margin: 8px 0;
    border-radius: var(--border-radius);
    border-left: 4px solid var(--info-color);
    color: var(--primary-color); 
        }
        
        .confidence-badge {
            background: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .sentiment-distribution {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }
        
        .sentiment-bar {
            flex: 1;
            height: 8px;
            border-radius: 4px;
        }
        
        .recommendation-item {
            padding: 12px;
    margin: 8px 0;
    background: var(--light-gray);
    border-radius: var(--border-radius);
    border-left: 4px solid var(--warning-color);
    color: var(--primary-color);
        }

        /* Estilos para análise de áudio */
        .audio-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .audio-visualizer {
            width: 100%;
            height: 100px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: var(--accent-color);
            margin: 0 1px;
        }
        
        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #ffebee;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }
        
        .pulse {
            width: 12px;
            height: 12px;
            background: #f44336;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }
        
        .transcription-result {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .transcription-line {
            padding: 8px;
            margin: 5px 0;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .transcription-line:hover {
            background: var(--medium-gray);
            border-left-color: var(--info-color);
        }
        
        .speaker-label {
            font-weight: bold;
            color: var(--info-color);
            margin-right: 8px;
        }
        
        .audio-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .audio-metric {
            text-align: center;
            padding: 15px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .waveform-container {
            width: 100%;
            height: 80px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }
        
        .audio-player-custom {
            width: 100%;
            margin: 10px 0;
        }

        .paste-transcription-container {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
        }

        /* Novos estilos para melhorias */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-gray);
            color: var(--secondary-color);
            text-align: center;
            border-radius: var(--border-radius);
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            background: var(--secondary-color);
            cursor: pointer;
            border-radius: 4px;
        }

        .pagination button.active {
            background: var(--primary-color);
            color: var(--secondary-color);
        }

        .pagination button:hover:not(.active) {
            background: var(--light-gray);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            color: white;
        }

        .loading-overlay .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
        }

        .validation-error {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.2) !important;
        }

        .validation-message {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .cache-indicator {
            background: var(--info-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 5px;
        }

        /* Estilos para as novas métricas */
        .metric-card:nth-child(6) { border-left: 4px solid #9C27B0; }
        .metric-card:nth-child(7) { border-left: 4px solid #FF9800; }
        .metric-card:nth-child(8) { border-left: 4px solid #2196F3; }

        .nps-positive { color: #4CAF50 !important; }
        .nps-negative { color: #F44336 !important; }

        .sidebar.collapsed #statsContainer {
            display: none;
        }

        /* Novos estilos para insights */
        .hourly-pattern {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }

        .hour-bar {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .hour-label {
            width: 40px;
            font-weight: bold;
        }

        .hour-count {
            width: 40px;
            text-align: right;
            margin-right: 10px;
        }

        .hour-visual {
            flex: 1;
            height: 20px;
            background: var(--accent-color);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .hour-visual:hover {
            opacity: 0.8;
        }

        .pattern-high {
            background: #4CAF50;
        }

        .pattern-medium {
            background: #FFC107;
        }

        .pattern-low {
            background: #F44336;
        }

        .insight-badge {
            display: inline-block;
            background: var(--info-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="logo">
                <div class="logo-icon">🛡️</div>
                <div class="logo-text">Sentinela</div>
            </div>
            
            <div class="sidebar-content">
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </h3>
                    <div class="input-group">
                        <label>Data Inicial</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="input-group">
                        <label>Data Final</label>
                        <input type="date" id="endDate">
                    </div>
                    <button class="button button-primary" id="applyFilter">
                        <i class="fas fa-filter"></i>
                        <span>Aplicar Filtro</span>
                    </button>
                </div>
                
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-database"></i>
                        <span>Fontes de Dados</span>
                    </h3>
                    <div class="input-group">
                        <label>Upload de Arquivo</label>
                        <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls">
                    </div>
                    <div class="input-group">
                        <label>ID da Planilha Google</label>
                        <input type="text" id="sheetId" placeholder="ID da planilha">
                    </div>
                    <div class="input-group">
                        <label>Nome da Aba</label>
                        <input type="text" id="sheetTab" placeholder="Nome da aba (ex: Página1)">
                    </div>
                    <button class="button button-primary" id="loadData">
                        <i class="fas fa-sync-alt"></i>
                        <span>Carregar Dados</span>
                    </button>
                </div>
                
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        <span>Estatísticas</span>
                    </h3>
                    <div id="statsContainer">
                        <div class="metric-card">
                            <div class="metric-label">
                                Total de Interações
                                <span class="tooltip">
                                    <i class="fas fa-question-circle"></i>
                                    <span class="tooltiptext">Número total de conversas únicas entre agentes e clientes</span>
                                </span>
                            </div>
                            <div class="metric-value" id="statInteractions">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">
                                Total de Mensagens
                                <span class="tooltip">
                                    <i class="fas fa-question-circle"></i>
                                    <span class="tooltiptext">Número total de mensagens trocadas em todas as conversas</span>
                                </span>
                            </div>
                            <div class="metric-value" id="statMessages">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">
                                Agentes Únicos
                                <span class="tooltip">
                                    <i class="fas fa-question-circle"></i>
                                    <span class="tooltiptext">Número de agentes diferentes que participaram das conversas</span>
                                </span>
                            </div>
                            <div class="metric-value" id="statAgents">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header" id="header">
            <div class="header-title">Painel de Análise</div>
            <div class="header-actions">
                <button class="button button-info" id="exportData">
                    <i class="fas fa-download"></i>
                    Exportar
                </button>
                <button class="button button-primary" id="refreshData">
                    <i class="fas fa-redo"></i>
                    Atualizar
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <p>Carregando Sentinela...</p>
            </div>
            
            <div id="contentArea" class="hidden">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Bem-vindo ao Sentinela!</strong> Carregue seus dados para começar a análise.
                    </div>
                </div>
                
                <!-- Métricas Principais -->
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Métricas existentes permanecem as mesmas -->
                    <div class="metric-card">
                        <div class="metric-icon">🛡️</div>
                        <div class="metric-value" id="metricInteractions">0</div>
                        <div class="metric-label">
                            Interações
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Número total de conversas únicas entre agentes e clientes</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricInteractionsTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">💬</div>
                        <div class="metric-value" id="metricMessages">0</div>
                        <div class="metric-label">
                            Mensagens
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Número total de mensagens trocadas em todas as conversas</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricMessagesTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">✅</div>
                        <div class="metric-value" id="metricPositive">0</div>
                        <div class="metric-label">
                            Positivas
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Mensagens com sentimento positivo identificado</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricPositiveTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">⚠️</div>
                        <div class="metric-value" id="metricNegative">0</div>
                        <div class="metric-label">
                            Negativas
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Mensagens com sentimento negativo identificado</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricNegativeTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">🔍</div>
                        <div class="metric-value" id="metricProblems">0</div>
                        <div class="metric-label">
                            Problemas
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Problemas ou dificuldades identificados nas conversas</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricProblemsTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <!-- Novas Métricas -->
                    <div class="metric-card">
                        <div class="metric-icon">🎯</div>
                        <div class="metric-value" id="metricResolutionRate">0%</div>
                        <div class="metric-label">
                            Taxa de Resolução
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Percentual de problemas identificados que foram resolvidos<br>80%+: Excelente | 60-80%: Bom | &lt;60%: Melhorar</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricResolutionRateTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">⚡</div>
                        <div class="metric-value" id="metricEfficiency">0</div>
                        <div class="metric-label">
                            Eficiência
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Mensagens por interação (eficiência na comunicação)<br>2-4: Ideal | &gt;4: Muito longo | &lt;2: Muito curto</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricEfficiencyTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">😊</div>
                        <div class="metric-value" id="metricNPS">0</div>
                        <div class="metric-label">
                            NPS Estimado
                            <span class="tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltiptext">Pontuação baseada no sentimento (% Positivas - % Negativas) × 10<br>&gt;50: Excelente | 0-50: Bom | &lt;0: Crítico</span>
                            </span>
                        </div>
                        <div class="metric-trend" id="metricNPSTrend">
                            <i class="fas fa-minus"></i>
                            <span>Carregando...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Abas -->
                <div class="tabs" id="mainTabs">
                    <div class="tab active" data-tab="overview">
                        <i class="fas fa-chart-bar"></i>
                        Visão Geral
                    </div>
                    <div class="tab" data-tab="agents">
                        <i class="fas fa-users"></i>
                        Agentes
                    </div>
                    <div class="tab" data-tab="trends">
                        <i class="fas fa-chart-line"></i>
                        Tendências
                    </div>
                    <div class="tab" data-tab="words">
                        <i class="fas fa-font"></i>
                        Análise de Texto
                    </div>
                    <div class="tab" data-tab="ai">
                        <i class="fas fa-robot"></i>
                        IA Avançada
                    </div>
                    <div class="tab" data-tab="audio">
                        <i class="fas fa-microphone"></i>
                        Análise de Áudio
                    </div>
                </div>
                
                <!-- Conteúdo das Abas -->
                <div id="tabContents">
                    <div class="tab-content active" id="overview">
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-smile"></i>
                                    Distribuição de Sentimento
                                </div>
                                <div id="sentimentChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-users"></i>
                                    Agentes com Mais Atendimentos
                                </div>
                                <div id="agentsChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-chart-pie"></i>
                                    Análise de Conteúdo
                                </div>
                                <div id="contentChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-calendar-alt"></i>
                                    Evolução Temporal
                                </div>
                                <div id="temporalChart"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="agents">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Desempenho por Agente</div>
                                <button class="button button-info" id="exportAgents">
                                    <i class="fas fa-download"></i>
                                    Exportar Relatório
                                </button>
                            </div>
                            <div id="agentsTable"></div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="trends">
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-chart-line"></i>
                                    Métricas ao Longo do Tempo
                                </div>
                                <div id="trendsChart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-project-diagram"></i>
                                    Correlação entre Métricas
                                </div>
                                <div id="correlationChart"></div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Dados Diários</div>
                                <button class="button button-info" id="exportTrends">
                                    <i class="fas fa-download"></i>
                                    Exportar Dados
                                </button>
                            </div>
                            <div id="dailyTable"></div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="words">
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-cloud"></i>
                                    Nuvem de Palavras
                                    <button class="button button-info" style="margin-left: auto; padding: 5px 10px; font-size: 0.8rem;" id="refreshWordCloud">
                                        <i class="fas fa-sync-alt"></i>
                                        Atualizar
                                    </button>
                                </div>
                                <div id="wordCloud" class="word-cloud-container"></div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-chart-bar"></i>
                                    Palavras Mais Frequentes
                                </div>
                                <div id="wordFrequencyChart"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Busca Avançada por Palavras</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Buscar Palavra ou Frase</label>
                                    <input type="text" id="wordSearch" placeholder="Ex: cartão de crédito, problema técnico...">
                                </div>
                                <div class="form-group">
                                    <label>Filtrar por Sentimento</label>
                                    <select id="sentimentFilter">
                                        <option value="all">Todos</option>
                                        <option value="positive">Positivo</option>
                                        <option value="negative">Negativo</option>
                                        <option value="neutral">Neutro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Contexto da Busca</label>
                                    <select id="contextFilter">
                                        <option value="all">Todos</option>
                                        <option value="problems">Problemas</option>
                                        <option value="complaints">Reclamações</option>
                                        <option value="praise">Elogios</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <button class="button button-primary" id="performSearch">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                                <button class="button button-secondary" id="clearSearch">
                                    <i class="fas fa-times"></i>
                                    Limpar
                                </button>
                            </div>
                            <div id="searchResults" class="mt-20"></div>
                            
                            <!-- Gráfico de Timeline para ocorrências por dia -->
                            <div class="chart-container mt-20">
                                <div class="chart-title">
                                    <i class="fas fa-chart-line"></i>
                                    Ocorrências ao Longo do Tempo
                                </div>
                                <div id="timelineChart"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Análise de Combinações de Palavras</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Frase para Análise</label>
                                    <input type="text" id="phraseInput" placeholder="Ex: cartão de crédito, suporte técnico...">
                                </div>
                            </div>
                            <div class="form-row">
                                <button class="button button-primary" id="analyzePhrase">
                                    <i class="fas fa-chart-bar"></i>
                                    Analisar Frase
                                </button>
                            </div>
                            <div id="phraseAnalysis" class="phrase-analysis"></div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Gerenciar Stop Words</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Adicionar Stop Word</label>
                                    <input type="text" id="newStopWord" placeholder="Digite uma palavra para adicionar...">
                                </div>
                            </div>
                            <div class="form-row">
                                <button class="button button-primary" id="addStopWord">
                                    <i class="fas fa-plus"></i>
                                    Adicionar
                                </button>
                                <button class="button button-secondary" id="resetStopWords">
                                    <i class="fas fa-undo"></i>
                                    Restaurar Padrão
                                </button>
                            </div>
                            <div class="stop-words-list" id="stopWordsList">
                                <!-- Stop words serão carregadas aqui -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="ai">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Análise com IA Avançada</div>
                                <div id="modelStatus" class="model-status status-ready">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Análise de IA Básica Disponível</span>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-robot"></i>
                                <div>
                                    <strong>Análise Inteligente</strong> - Use análise de texto avançada para obter insights profundos sobre suas conversas.
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tipo de Análise</label>
                                    <select id="analysisType">
                                        <option value="sentiment">Análise de Sentimento Avançada</option>
                                        <option value="topics">Identificação de Tópicos</option>
                                        <option value="summary">Sumarização de Conversas</option>
                                        <option value="insights">Insights Gerais</option>
                                        <option value="quality">Análise de Qualidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Modelo de IA</label>
                                    <select id="modelSelection">
                                        <option value="sentiment">Análise de Sentimento (BERT)</option>
                                        <option value="topic">Identificação de Tópicos</option>
                                        <option value="summarization">Sumarização (T5)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label>Prompt para Análise</label>
                                <textarea id="iaPrompt" rows="4">Analise estas conversas e identifique os principais problemas, oportunidades de melhoria e pontos fortes:</textarea>
                            </div>
                            
                            <div class="form-row">
                                <button class="button button-primary" id="generateInsights">
                                    <i class="fas fa-brain"></i>
                                    Gerar Insights com IA
                                </button>
                                <button class="button button-info" id="quickAnalysis">
                                    <i class="fas fa-bolt"></i>
                                    Análise Rápida
                                </button>
                                <button class="button button-secondary" id="clearAnalysis">
                                    <i class="fas fa-times"></i>
                                    Limpar
                                </button>
                            </div>
                            
                            <div id="analysisProgress" class="analysis-progress hidden">
                                <div class="progress-bar-fill" id="progressFill" style="width: 0%"></div>
                            </div>
                            
                            <div id="iaResults" class="mt-20"></div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Análise de Tópicos Avançada</div>
                            </div>
                            <div class="form-row">
                                <button class="button button-primary" id="analyzeTopics">
                                    <i class="fas fa-project-diagram"></i>
                                    Identificar Tópicos
                                </button>
                                <button class="button button-info" id="clusterAnalysis">
                                    <i class="fas fa-object-group"></i>
                                    Análise de Clusters
                                </button>
                            </div>
                            <div id="topicsResults" class="mt-20"></div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Recomendações Inteligentes</div>
                            </div>
                            <div id="recommendationsList"></div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="audio">
                        <!-- Conteúdo da aba de áudio permanece o mesmo -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Análise de Áudio</div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-microphone"></i>
                                <div>
                                    <strong>Transcrição e Análise de Áudio</strong> - Grave áudio em tempo real ou cole transcrições diretamente.
                                </div>
                            </div>
                            
                            <div class="audio-metrics" id="audioMetrics">
                                <div class="audio-metric">
                                    <div class="metric-label">Status</div>
                                    <div class="metric-value" id="audioStatus">Pronto</div>
                                </div>
                                <div class="audio-metric">
                                    <div class="metric-label">Duração</div>
                                    <div class="metric-value" id="audioDuration">0s</div>
                                </div>
                                <div class="audio-metric">
                                    <div class="metric-label">Confiança</div>
                                    <div class="metric-value" id="audioConfidence">0%</div>
                                </div>
                                <div class="audio-metric">
                                    <div class="metric-label">Palavras</div>
                                    <div class="metric-value" id="wordCount">0</div>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">
                                    <i class="fas fa-microphone-alt"></i>
                                    Gravação em Tempo Real
                                </h3>
                                
                                <div class="audio-controls">
                                    <button class="button button-primary" id="startRecording">
                                        <i class="fas fa-microphone"></i>
                                        Iniciar Gravação
                                    </button>
                                    <button class="button button-danger" id="stopRecording" disabled>
                                        <i class="fas fa-stop"></i>
                                        Parar Gravação
                                    </button>
                                    <button class="button button-secondary" id="clearRecording">
                                        <i class="fas fa-trash"></i>
                                        Limpar
                                    </button>
                                </div>
                                
                                <div id="recordingIndicator" class="recording-indicator hidden">
                                    <div class="pulse"></div>
                                    <span>Gravando áudio... Fale agora!</span>
                                    <span id="recordingTimer">00:00</span>
                                </div>
                                
                                <div class="audio-visualizer" id="audioVisualizer">
                                    <!-- Barras do visualizador serão geradas aqui -->
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">
                                    <i class="fas fa-paste"></i>
                                    Colar Transcrição Diretamente
                                </h3>
                                
                                <div class="paste-transcription-container">
                                    <div class="input-group">
                                        <label>Cole sua transcrição aqui:</label>
                                        <textarea id="pasteTranscription" rows="6" placeholder="Cole o texto transcrito diretamente aqui..."></textarea>
                                    </div>
                                    <div class="audio-controls">
                                        <button class="button button-success" id="usePastedTranscription">
                                            <i class="fas fa-check"></i>
                                            Usar Esta Transcrição
                                        </button>
                                        <button class="button button-secondary" id="clearPastedTranscription">
                                            <i class="fas fa-times"></i>
                                            Limpar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">
                                    <i class="fas fa-file-alt"></i>
                                    Transcrição
                                </h3>
                                
                                <div class="input-group">
                                    <label>Configurações de Transcrição</label>
                                    <select id="languageSelect">
                                        <option value="pt-BR">Português (Brasil)</option>
                                        <option value="en-US">Inglês (EUA)</option>
                                        <option value="es-ES">Espanhol</option>
                                    </select>
                                </div>
                                
                                <div class="transcription-result" id="transcriptionResults">
                                    <p class="text-center" style="color: #666;">
                                        A transcrição aparecerá aqui...
                                    </p>
                                </div>
                                
                                <div class="audio-controls">
                                    <button class="button button-success" id="copyTranscription">
                                        <i class="fas fa-copy"></i>
                                        Copiar Transcrição
                                    </button>
                                    <button class="button button-info" id="exportTranscription">
                                        <i class="fas fa-download"></i>
                                        Exportar TXT
                                    </button>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">
                                    <i class="fas fa-robot"></i>
                                    Análise com IA
                                </h3>
                                
                                <div class="input-group">
                                    <label>Prompt para Análise do Áudio</label>
                                    <textarea id="audioPrompt" rows="4">Analise esta conversa transcrita e identifique os principais problemas, sentimentos e oportunidades:</textarea>
                                </div>
                                
                                <div class="form-row">
                                    <button class="button button-primary" id="analyzeAudio">
                                        <i class="fas fa-search"></i>
                                        Analisar com IA
                                    </button>
                                    <button class="button button-info" id="quickAudioAnalysis">
                                        <i class="fas fa-bolt"></i>
                                        Análise Rápida
                                    </button>
                                </div>
                                
                                <div id="audioAnalysisResults" class="mt-20"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE GERAÇÃO DE INSIGHTS REAIS
        // =============================================
        class RealInsightGenerator {
            constructor(data) {
                this.data = data;
            }

            generateDataDrivenInsights() {
                const insights = [];
                
                // 1. Análise de Problemas Recorrentes
                const problemPatterns = this.analyzeProblemPatterns();
                if (problemPatterns.frequentIssues.length > 0) {
                    insights.push({
                        type: 'warning',
                        title: 'Problemas Recorrentes Identificados',
                        description: `${problemPatterns.frequentIssues.length} problemas aparecem frequentemente`,
                        details: problemPatterns.frequentIssues.slice(0, 3),
                        confidence: this.calculateConfidence(problemPatterns)
                    });
                }
                
                // 2. Padrões Temporais Reais
                const temporalPatterns = this.analyzeTemporalPatterns();
                if (temporalPatterns.hasPeakHours) {
                    insights.push({
                        type: 'info',
                        title: 'Padrão de Demanda Identificado',
                        description: `Pico de atendimentos às ${temporalPatterns.peakHour}h`,
                        recommendation: 'Considere aumentar equipe neste horário',
                        confidence: 0.85
                    });
                }

                // 3. Análise de Horários de Ocorrências
                const hourPatterns = this.analyzeHourPatterns();
                if (hourPatterns.peakHours.length > 0) {
                    insights.push({
                        type: 'info',
                        title: 'Horários de Pico',
                        description: `Maior volume de mensagens entre ${hourPatterns.peakHours.join('h e ')}h`,
                        details: hourPatterns.peakHours.map(hour => `${hour}h: ${hourPatterns.hourlyCounts[hour]} mensagens`),
                        confidence: 0.8
                    });
                }
                
                // 4. Análise de Performance por Agente
                const agentInsights = this.analyzeAgentPerformance();
                if (agentInsights.length > 0) {
                    insights.push({
                        type: 'info',
                        title: 'Performance por Agente',
                        description: `${agentInsights.length} agentes com desempenho diferenciado`,
                        details: agentInsights,
                        confidence: 0.9
                    });
                }
                
                return insights;
            }
            
            analyzeProblemPatterns() {
                const problemKeywords = {
                    'Problemas Técnicos': ['não funciona', 'erro', 'bug', 'falha', 'quebrado', 'lento', 'travando'],
                    'Cobrança': ['cobrança', 'fatura', 'pagamento', 'cartão', 'valor', 'preço', 'tarifa'],
                    'Atendimento': ['espera', 'demora', 'lento', 'atendimento', 'suporte', 'resposta'],
                    'Produto': ['produto', 'serviço', 'funcionalidade', 'aplicativo', 'app', 'sistema'],
                    'Conta': ['conta', 'login', 'senha', 'acesso', 'cadastro', 'registro']
                };
                
                const patterns = { frequentIssues: [] };
                
                Object.entries(problemKeywords).forEach(([category, keywords]) => {
                    const count = this.data.filter(item => 
                        keywords.some(keyword => 
                            item.Texto.toLowerCase().includes(keyword)
                        )
                    ).length;
                    
                    if (count > this.data.length * 0.1) { // Mais de 10% das conversas
                        patterns.frequentIssues.push({
                            category,
                            frequency: count,
                            percentage: (count / this.data.length * 100).toFixed(1)
                        });
                    }
                });
                
                return patterns;
            }

            analyzeTemporalPatterns() {
                // Agrupar por dia da semana
                const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
                const dailyCounts = {};

                this.data.forEach(item => {
                    const date = new Date(item.Data);
                    const day = daysOfWeek[date.getDay()];
                    dailyCounts[day] = (dailyCounts[day] || 0) + 1;
                });

                // Encontrar o dia com maior volume
                const maxDay = Object.keys(dailyCounts).reduce((a, b) => dailyCounts[a] > dailyCounts[b] ? a : b);
                const avg = Object.values(dailyCounts).reduce((a, b) => a + b, 0) / Object.keys(dailyCounts).length;
                const increase = ((dailyCounts[maxDay] - avg) / avg) * 100;

                return {
                    hasPeakDays: increase > 20,
                    peakDay: maxDay,
                    increase: increase.toFixed(1),
                    dailyCounts
                };
            }

            analyzeHourPatterns() {
                // Agrupar por hora
                const hourlyCounts = {};
                this.data.forEach(item => {
                    if (item.Hora) {
                        const hour = parseInt(item.Hora.split(':')[0]);
                        hourlyCounts[hour] = (hourlyCounts[hour] || 0) + 1;
                    }
                });

                // Encontrar as horas com maior volume (top 3)
                const sortedHours = Object.keys(hourlyCounts).sort((a, b) => hourlyCounts[b] - hourlyCounts[a]);
                const peakHours = sortedHours.slice(0, 3).map(hour => parseInt(hour));

                return {
                    peakHours,
                    hourlyCounts
                };
            }

            analyzeAgentPerformance() {
                const agentStats = {};
                
                this.data.forEach(item => {
                    const agent = item.Agente;
                    if (!agentStats[agent]) {
                        agentStats[agent] = { 
                            count: 0, 
                            positive: 0, 
                            negative: 0,
                            problems: 0
                        };
                    }
                    
                    agentStats[agent].count++;
                    
                    if (item.Sentimento === 'Positivo' || item.Sentimento === 'Muito Positivo') {
                        agentStats[agent].positive++;
                    } else if (item.Sentimento === 'Negativo' || item.Sentimento === 'Muito Negativo') {
                        agentStats[agent].negative++;
                    }
                    
                    // Contar problemas (simplificado)
                    const problemWords = ['problema', 'erro', 'não funciona', 'bug', 'falha'];
                    if (problemWords.some(word => item.Texto.toLowerCase().includes(word))) {
                        agentStats[agent].problems++;
                    }
                });

                // Calcular métricas de performance
                const performance = Object.entries(agentStats).map(([agent, stats]) => {
                    const satisfactionRate = stats.positive / stats.count * 100;
                    const problemRate = stats.problems / stats.count * 100;
                    
                    return {
                        agent,
                        interactions: stats.count,
                        satisfactionRate: satisfactionRate.toFixed(1),
                        problemRate: problemRate.toFixed(1),
                        performance: (satisfactionRate - problemRate).toFixed(1)
                    };
                });

                // Retornar apenas agentes com performance diferenciada
                return performance
                    .filter(p => p.interactions > 5)
                    .sort((a, b) => b.performance - a.performance)
                    .slice(0, 3);
            }

            calculateConfidence(patterns) {
                // Simular confiança baseada na quantidade de dados e consistência
                const dataVolume = Math.min(this.data.length / 100, 1.0);
                const consistency = patterns.frequentIssues.length > 0 ? 0.8 : 0.5;
                return (dataVolume * 0.6 + consistency * 0.4).toFixed(2);
            }
        }

        // =============================================
        // SISTEMA DE ANÁLISE DE CORRELAÇÃO
        // =============================================
        class CorrelationAnalyzer {
            calculateCorrelation(x, y) {
                if (x.length !== y.length || x.length === 0) return 0;
                
                const n = x.length;
                let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
                
                for (let i = 0; i < n; i++) {
                    sumX += x[i];
                    sumY += y[i];
                    sumXY += x[i] * y[i];
                    sumX2 += x[i] * x[i];
                    sumY2 += y[i] * y[i];
                }
                
                const numerator = n * sumXY - sumX * sumY;
                const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
                
                return denominator === 0 ? 0 : numerator / denominator;
            }

            findSignificantCorrelations(metrics) {
                const correlations = [];
                
                // Correlação entre problemas e sentimentos negativos
                const problemNegativeCorr = this.calculateCorrelation(
                    metrics.problemsArray, 
                    metrics.negativeArray
                );
                
                if (Math.abs(problemNegativeCorr) > 0.7) {
                    correlations.push({
                        metric1: 'Problemas Reportados',
                        metric2: 'Sentimento Negativo',
                        strength: problemNegativeCorr,
                        insight: problemNegativeCorr > 0 ? 
                            'Problemas estão diretamente relacionados à insatisfação' :
                            'Relação inversa inesperada'
                    });
                }
                
                return correlations;
            }
        }

        // =============================================
        // SISTEMA DE DETECÇÃO DE ANOMALIAS
        // =============================================
        class AnomalyDetector {
            constructor(data) {
                this.data = data;
            }

            detectServiceIssues() {
                const dailyStats = this.calculateDailyStats();
                const anomalies = [];
                
                // Detectar picos repentinos de problemas
                const problemSpikes = this.findSpikes(dailyStats.problems, 2.0); // 200% acima da média
                problemSpikes.forEach(spike => {
                    anomalies.push({
                        date: spike.date,
                        type: 'pico_problemas',
                        severity: 'alta',
                        description: `Pico de problemas em ${spike.date}: ${spike.value} (${spike.increase}% acima da média)`,
                        possibleCauses: this.suggestCauses(spike.date)
                    });
                });
                
                return anomalies;
            }
            
            calculateDailyStats() {
                const dailyStats = {};
                
                this.data.forEach(item => {
                    if (!dailyStats[item.Data]) {
                        dailyStats[item.Data] = { problems: 0, total: 0 };
                    }
                    dailyStats[item.Data].total++;
                    
                    // Contar problemas (simplificado)
                    const problemWords = ['problema', 'erro', 'não funciona', 'bug', 'falha'];
                    if (problemWords.some(word => item.Texto.toLowerCase().includes(word))) {
                        dailyStats[item.Data].problems++;
                    }
                });
                
                return dailyStats;
            }

            findSpikes(dailyCounts, thresholdFactor) {
                const values = Object.values(dailyCounts).map(stat => stat.problems);
                const dates = Object.keys(dailyCounts);
                const avg = values.reduce((a, b) => a + b, 0) / values.length;
                
                const spikes = [];
                values.forEach((value, index) => {
                    if (value > avg * thresholdFactor) {
                        spikes.push({
                            date: dates[index],
                            value: value,
                            increase: ((value - avg) / avg * 100).toFixed(1)
                        });
                    }
                });
                
                return spikes;
            }

            suggestCauses(date) {
                const dayData = this.data.filter(item => item.Data === date);
                const textAnalyzer = new TextAnalyzer();
                textAnalyzer.calculateFrequencies(dayData);
                const frequentWords = textAnalyzer.getTopWords(5);
                
                return frequentWords.slice(0, 3).map(([word]) => word);
            }
        }

        // =============================================
        // ANALISADOR DE IA AVANÇADA - MELHORADO
        // =============================================
        class AdvancedAIAnalyzer {
            constructor() {
                this.isInitialized = true;
            }

            async generateInsights(conversations, prompt) {
                console.log(`Análise solicitada com foco em: "${prompt}"`);
                
                const allText = conversations.map(c => c.Texto).join(' ');
                const sentimentResult = await this.analyzeSentimentAdvanced(allText);
                const summary = await this.summarizeText(allText, 100); // Resumo mais curto
                
                // USAR O PROMPT PARA FILTRAR TÓPICOS RELEVANTES
                const allTopics = this.extractTopics(conversations);
                const relevantTopics = this.filterTopicsByPrompt(allTopics, prompt);
                
                // Gerar insights baseados em dados
                const insightGenerator = new RealInsightGenerator(conversations);
                const dataInsights = insightGenerator.generateDataDrivenInsights();

                // Análise de correlação
                const correlationAnalyzer = new CorrelationAnalyzer();
                const correlations = correlationAnalyzer.findSignificantCorrelations(this.prepareMetrics(conversations));

                // Detecção de anomalias
                const anomalyDetector = new AnomalyDetector(conversations);
                const anomalies = anomalyDetector.detectServiceIssues();

                return {
                    prompt: prompt,
                    analysisContext: this.getContextFromPrompt(prompt),
                    sentiment: sentimentResult,
                    summary: summary,
                    topics: relevantTopics,
                    dataInsights: dataInsights,
                    correlations: correlations,
                    anomalies: anomalies,
                    recommendations: this.generateContextualRecommendations(
                        sentimentResult, relevantTopics, prompt, dataInsights, correlations, anomalies
                    ),
                    confidence: sentimentResult.confidence
                };
            }

            prepareMetrics(conversations) {
                const problemsArray = conversations.map(c => {
                    const problemWords = ['problema', 'erro', 'não funciona', 'bug', 'falha'];
                    return problemWords.some(word => c.Texto.toLowerCase().includes(word)) ? 1 : 0;
                });
                
                const negativeArray = conversations.map(c => 
                    (c.Sentimento === 'Negativo' || c.Sentimento === 'Muito Negativo') ? 1 : 0
                );

                return {
                    problemsArray,
                    negativeArray
                };
            }

            filterTopicsByPrompt(topics, prompt) {
                if (!prompt || prompt.trim() === '') {
                    return topics;
                }
                
                const promptLower = prompt.toLowerCase();
                
                const promptMappings = {
                    'técnico': 'Problemas Técnicos',
                    'problema': 'Problemas Técnicos', 
                    'bug': 'Problemas Técnicos',
                    'atendimento': 'Atendimento ao Cliente',
                    'suporte': 'Atendimento ao Cliente',
                    'pagamento': 'Cobrança e Pagamentos',
                    'cobrança': 'Cobrança e Pagamentos',
                    'produto': 'Produtos e Serviços',
                    'serviço': 'Produtos e Serviços',
                    'elogio': 'Elogios',
                    'reclamação': 'Reclamações'
                };
                
                const relevantTopicNames = [];
                Object.keys(promptMappings).forEach(keyword => {
                    if (promptLower.includes(keyword)) {
                        relevantTopicNames.push(promptMappings[keyword]);
                    }
                });
                
                if (relevantTopicNames.length > 0) {
                    return topics.filter(([topic]) => relevantTopicNames.includes(topic));
                }
                
                return topics;
            }

            getContextFromPrompt(prompt) {
                if (!prompt) return 'Análise geral das conversas';
                
                const promptLower = prompt.toLowerCase();
                let context = 'Análise focada em: ';
                
                if (promptLower.includes('técnico') || promptLower.includes('problema')) {
                    context += 'Problemas Técnicos, ';
                }
                if (promptLower.includes('atendimento') || promptLower.includes('suporte')) {
                    context += 'Qualidade de Atendimento, ';
                }
                if (promptLower.includes('pagamento') || promptLower.includes('cobrança')) {
                    context += 'Questões Financeiras, ';
                }
                if (promptLower.includes('produto') || promptLower.includes('serviço')) {
                    context += 'Produtos e Serviços, ';
                }
                
                return context.slice(0, -2);
            }

            generateContextualRecommendations(sentiment, topics, prompt, dataInsights, correlations, anomalies) {
                const recommendations = [];
                const promptLower = prompt.toLowerCase();
                
                // RECOMENDAÇÕES BASEADAS NO PROMPT
                if (promptLower.includes('técnico') || promptLower.includes('problema')) {
                    recommendations.push({
                        type: 'info',
                        title: 'Foco em Problemas Técnicos',
                        description: 'Análise priorizou questões técnicas mencionadas no seu prompt.',
                        priority: 'Alta'
                    });
                }
                
                if (promptLower.includes('atendimento') || promptLower.includes('suporte')) {
                    recommendations.push({
                        type: 'info', 
                        title: 'Foco em Qualidade de Atendimento',
                        description: 'Análise focada na qualidade do atendimento conforme solicitado.',
                        priority: 'Alta'
                    });
                }
                
                // RECOMENDAÇÕES BASEADAS EM INSIGHTS DE DADOS
                dataInsights.forEach(insight => {
                    recommendations.push({
                        type: insight.type,
                        title: insight.title,
                        description: insight.description,
                        priority: 'Média'
                    });
                });

                // RECOMENDAÇÕES BASEADAS EM CORRELAÇÕES
                correlations.forEach(correlation => {
                    recommendations.push({
                        type: 'info',
                        title: `Correlação: ${correlation.metric1} e ${correlation.metric2}`,
                        description: correlation.insight,
                        priority: 'Média'
                    });
                });

                // RECOMENDAÇÕES BASEADAS EM ANOMALIAS
                anomalies.forEach(anomaly => {
                    recommendations.push({
                        type: 'error',
                        title: `Anomalia Detectada: ${anomaly.type}`,
                        description: anomaly.description,
                        priority: 'Alta'
                    });
                });

                // RECOMENDAÇÃO SOBRE O USO DO PROMPT
                recommendations.push({
                    type: 'info',
                    title: 'Contexto da Análise',
                    description: `Análise realizada considerando: "${prompt}"`,
                    priority: 'Média'
                });

                return recommendations;
            }

            // Métodos auxiliares existentes mantidos
            async analyzeSentimentAdvanced(text) {
                // Simulação de análise de sentimento
                const positiveWords = ['bom', 'ótimo', 'excelente', 'gostei', 'parabéns', 'obrigado', 'resolvido'];
                const negativeWords = ['ruim', 'péssimo', 'horrível', 'problema', 'erro', 'lento', 'demora'];
                
                let positiveCount = 0;
                let negativeCount = 0;
                
                const words = text.toLowerCase().split(/\s+/);
                
                words.forEach(word => {
                    if (positiveWords.some(p => word.includes(p))) positiveCount++;
                    if (negativeWords.some(n => word.includes(n))) negativeCount++;
                });
                
                const total = positiveCount + negativeCount;
                const score = total > 0 ? (positiveCount - negativeCount) / total : 0;
                
                let sentiment = 'Neutro';
                if (score > 0.1) sentiment = 'Positivo';
                else if (score < -0.1) sentiment = 'Negativo';
                
                return {
                    sentiment: sentiment,
                    score: score,
                    confidence: Math.abs(score) * 0.8 + 0.2
                };
            }

            async summarizeText(text, maxLength = 100) {
                // Simulação de sumarização
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
                let summary = '';
                for (let sentence of sentences) {
                    if (summary.length + sentence.length < maxLength) {
                        summary += sentence + '. ';
                    } else {
                        break;
                    }
                }
                return summary || text.slice(0, maxLength) + '...';
            }

            extractTopics(conversations) {
                // Simulação de extração de tópicos
                const topics = {
                    'Problemas Técnicos': 0,
                    'Atendimento ao Cliente': 0,
                    'Cobrança e Pagamentos': 0,
                    'Produtos e Serviços': 0,
                    'Elogios': 0,
                    'Reclamações': 0
                };

                const keywords = {
                    'Problemas Técnicos': ['erro', 'problema', 'bug', 'falha', 'não funciona', 'quebrado', 'defeito'],
                    'Atendimento ao Cliente': ['atendimento', 'suporte', 'ajuda', 'assistência', 'consultor'],
                    'Cobrança e Pagamentos': ['pagamento', 'cobrança', 'fatura', 'cartão', 'dinheiro', 'preço'],
                    'Produtos e Serviços': ['produto', 'serviço', 'funcionalidade', 'recurso', 'aplicativo'],
                    'Elogios': ['parabéns', 'excelente', 'ótimo', 'maravilhoso', 'gostei', 'recomendo'],
                    'Reclamações': ['reclamação', 'insatisfeito', 'ruim', 'péssimo', 'decepcionado', 'lento']
                };

                conversations.forEach(conversation => {
                    const text = conversation.Texto.toLowerCase();
                    Object.keys(keywords).forEach(topic => {
                        keywords[topic].forEach(keyword => {
                            if (text.includes(keyword)) {
                                topics[topic]++;
                            }
                        });
                    });
                });

                return Object.entries(topics)
                    .filter(([_, count]) => count > 0)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
            }
        }

        // =============================================
        // CÓDIGO PRINCIPAL - INTEGRAÇÃO DAS MELHORIAS
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Inicialização do sistema de IA
            const aiAnalyzer = new AdvancedAIAnalyzer();
            
            // Configuração do Fuse.js para busca semântica
            const searchOptions = {
                includeScore: true,
                threshold: 0.3,
                keys: ['Texto', 'Agente', 'Sentimento']
            };
            
            // Função para exibir insights na interface
            function displayIAResults(results, analysisType) {
                const container = document.getElementById('iaResults');
                
                let resultsHTML = `
                    <div class="insight-card">
                        <div class="insight-header">
                            <i class="fas fa-robot insight-icon"></i>
                            <h3>Análise de IA - ${analysisType}</h3>
                        </div>
                        <div class="insight-content">
                            <p><strong>Contexto:</strong> ${results.analysisContext}</p>
                            <p><strong>Sentimento Geral:</strong> ${results.sentiment.sentiment} (${results.sentiment.score.toFixed(2)})</p>
                            <p><strong>Confiança:</strong> ${(results.sentiment.confidence * 100).toFixed(1)}%</p>
                            <p><strong>Resumo:</strong> ${results.summary}</p>
                        </div>
                    </div>
                `;
                
                // Tópicos principais
                if (results.topics && results.topics.length > 0) {
                    resultsHTML += `
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Tópicos Principais</div>
                            </div>
                            ${results.topics.map(([topic, count]) => `
                                <div class="topic-item">
                                    <strong>${topic}</strong>
                                    <span class="confidence-badge">${count} ocorrências</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Insights baseados em dados
                if (results.dataInsights && results.dataInsights.length > 0) {
                    resultsHTML += `
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Insights Baseados em Dados</div>
                            </div>
                            ${results.dataInsights.map(insight => `
                                <div class="recommendation-item">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                        <i class="fas fa-${insight.type === 'success' ? 'check-circle' : insight.type === 'warning' ? 'exclamation-triangle' : insight.type === 'error' ? 'times-circle' : 'info-circle'}" 
                                           style="color: ${insight.type === 'success' ? '#4CAF50' : insight.type === 'warning' ? '#FFC107' : insight.type === 'error' ? '#F44336' : '#2196F3'}"></i>
                                        <strong>${insight.title}</strong>
                                        <span class="confidence-badge" style="background: ${insight.priority === 'Alta' ? '#F44336' : insight.priority === 'Média' ? '#FFC107' : '#4CAF50'}">${insight.priority}</span>
                                    </div>
                                    <p>${insight.description}</p>
                                    ${insight.details ? `
                                        <div class="mt-10">
                                            <strong>Detalhes:</strong>
                                            <ul>
                                                ${insight.details.map(detail => {
                                                    if (typeof detail === 'string') {
                                                        return `<li>${detail}</li>`;
                                                    } else if (detail.category) {
                                                        return `<li>${detail.category}: ${detail.percentage}% (${detail.frequency} ocorrências)</li>`;
                                                    } else if (detail.agent) {
                                                        return `<li>${detail.agent}: ${detail.satisfactionRate}% satisfação</li>`;
                                                    }
                                                    return '';
                                                }).join('')}
                                            </ul>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Correlações
                if (results.correlations && results.correlations.length > 0) {
                    resultsHTML += `
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Correlações Significativas</div>
                            </div>
                            ${results.correlations.map(correlation => `
                                <div class="recommendation-item">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                        <i class="fas fa-chart-line" style="color: #2196F3;"></i>
                                        <strong>${correlation.metric1} × ${correlation.metric2}</strong>
                                        <span class="confidence-badge" style="background: #2196F3;">${correlation.strength.toFixed(2)}</span>
                                    </div>
                                    <p>${correlation.insight}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Anomalias
                if (results.anomalies && results.anomalies.length > 0) {
                    resultsHTML += `
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Anomalias Detectadas</div>
                            </div>
                            ${results.anomalies.map(anomaly => `
                                <div class="recommendation-item">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                        <i class="fas fa-exclamation-triangle" style="color: #F44336;"></i>
                                        <strong>${anomaly.type}</strong>
                                        <span class="confidence-badge" style="background: #F44336;">${anomaly.severity}</span>
                                    </div>
                                    <p>${anomaly.description}</p>
                                    <p><strong>Possíveis causas:</strong> ${anomaly.possibleCauses.join(', ')}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Recomendações
                if (results.recommendations && results.recommendations.length > 0) {
                    resultsHTML += `
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Recomendações Inteligentes</div>
                            </div>
                            ${results.recommendations.map(rec => `
                                <div class="recommendation-item">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                        <i class="fas fa-${rec.type === 'success' ? 'check-circle' : rec.type === 'warning' ? 'exclamation-triangle' : rec.type === 'error' ? 'times-circle' : 'info-circle'}" 
                                           style="color: ${rec.type === 'success' ? '#4CAF50' : rec.type === 'warning' ? '#FFC107' : rec.type === 'error' ? '#F44336' : '#2196F3'}"></i>
                                        <strong>${rec.title}</strong>
                                        <span class="confidence-badge" style="background: ${rec.priority === 'Alta' ? '#F44336' : rec.priority === 'Média' ? '#FFC107' : '#4CAF50'}">${rec.priority}</span>
                                    </div>
                                    <p>${rec.description}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                container.innerHTML = resultsHTML;
            }

            // Integração com o botão de geração de insights
            document.getElementById('generateInsights').addEventListener('click', async function() {
                const prompt = document.getElementById('iaPrompt').value;
                const analysisType = document.getElementById('analysisType').value;
                
                // Simulação de dados para demonstração
                const sampleData = generateSampleData();
                
                // Mostrar progresso
                const progressBar = document.getElementById('analysisProgress');
                const progressFill = document.getElementById('progressFill');
                progressBar.classList.remove('hidden');
                
                for (let i = 0; i <= 100; i += 10) {
                    progressFill.style.width = `${i}%`;
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Gerar insights
                const results = await aiAnalyzer.generateInsights(sampleData, prompt);
                
                // Exibir resultados
                displayIAResults(results, analysisType);
                
                // Esconder barra de progresso
                progressBar.classList.add('hidden');
            });

            // Função para gerar dados de exemplo
            function generateSampleData() {
                const agents = ['Ana Silva', 'Carlos Santos', 'Marina Oliveira', 'Pedro Costa', 'Julia Rodrigues'];
                const sentiments = ['Positivo', 'Negativo', 'Neutro', 'Muito Positivo', 'Muito Negativo'];
                const topics = [
                    'Problema com cartão de crédito',
                    'Dúvida sobre fatura',
                    'Elogio ao atendimento',
                    'Reclamação sobre serviço',
                    'Solicitação de informação',
                    'Problema técnico no aplicativo',
                    'Consulta sobre produtos',
                    'Feedback sobre experiência'
                ];

                const data = [];
                const startDate = new Date('2024-01-01');
                
                for (let i = 0; i < 50; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + Math.floor(i / 5));
                    
                    data.push({
                        Agente: agents[Math.floor(Math.random() * agents.length)],
                        Data: date.toISOString().split('T')[0],
                        Hora: `${Math.floor(Math.random() * 10 + 8).toString().padStart(2, '0')}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
                        Texto: `${topics[Math.floor(Math.random() * topics.length)]}. ${getRandomMessage()}`,
                        Sentimento: sentiments[Math.floor(Math.random() * sentiments.length)],
                        Pontuacao: (Math.random() * 2 - 1).toFixed(2),
                        Problemas: Math.floor(Math.random() * 3),
                        Solucoes: Math.floor(Math.random() * 3)
                    });
                }
                
                return data;
            }

            function getRandomMessage() {
                const messages = [
                    "Cliente relatou dificuldade com a funcionalidade.",
                    "Usuário satisfeito com o suporte recebido.",
                    "Problema identificado e resolvido rapidamente.",
                    "Cliente solicitou informações adicionais sobre o serviço.",
                    "Reclamação sobre tempo de espera no atendimento.",
                    "Elogio à qualidade do produto oferecido.",
                    "Dúvida sobre processo de renovação de contrato.",
                    "Sugestão de melhoria para a plataforma.",
                    "Problema técnico relatado e em análise.",
                    "Cliente agradeceu pela rápida solução."
                ];
                return messages[Math.floor(Math.random() * messages.length)];
            }

            // Inicializar interface
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.getElementById('contentArea').classList.remove('hidden');
        });
    </script>
</body>
</html>
